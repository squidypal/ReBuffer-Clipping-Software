<Window x:Class="ReBuffer.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Settings" 
        Height="780" 
        Width="600"
        WindowStartupLocation="CenterScreen"
        ResizeMode="NoResize"
        Background="#0D0D0D"
        FontFamily="Segoe UI">
    
    <Window.Resources>
        <!-- Modern TextBox Style -->
        <Style x:Key="ModernTextBox" TargetType="TextBox">
            <Setter Property="Background" Value="#1A1A1A"/>
            <Setter Property="Foreground" Value="#E0E0E0"/>
            <Setter Property="BorderBrush" Value="#2A2A2A"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="8"
                                Padding="{TemplateBinding Padding}">
                            <ScrollViewer x:Name="PART_ContentHost"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Modern ComboBox Style -->
        <Style x:Key="ModernComboBox" TargetType="ComboBox">
            <Setter Property="Background" Value="#1A1A1A"/>
            <Setter Property="Foreground" Value="#E0E0E0"/>
            <Setter Property="BorderBrush" Value="#2A2A2A"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="FontSize" Value="13"/>
        </Style>

        <!-- Modern Slider Style -->
        <Style x:Key="ModernSlider" TargetType="Slider">
            <Setter Property="Foreground" Value="#39c20f"/>
        </Style>

        <!-- Modern CheckBox Style -->
        <Style x:Key="ModernCheckBox" TargetType="CheckBox">
            <Setter Property="Foreground" Value="#E0E0E0"/>
            <Setter Property="FontSize" Value="13"/>
        </Style>

        <!-- Modern Button Style -->
        <Style x:Key="ModernButton" TargetType="Button">
            <Setter Property="Background" Value="#1A1A1A"/>
            <Setter Property="Foreground" Value="#E0E0E0"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                CornerRadius="10"
                                Padding="{TemplateBinding Padding}">
                            <Border.Effect>
                                <DropShadowEffect Color="#000000" 
                                                BlurRadius="12" 
                                                ShadowDepth="2" 
                                                Opacity="0.3"/>
                            </Border.Effect>
                            <ContentPresenter HorizontalAlignment="Center" 
                                            VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#252525"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Green Action Button -->
        <Style x:Key="GreenButton" TargetType="Button" BasedOn="{StaticResource ModernButton}">
            <Setter Property="Background" Value="#39c20f"/>
            <Setter Property="Foreground" Value="White"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#49f215"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Secondary Button -->
        <Style x:Key="SecondaryButton" TargetType="Button" BasedOn="{StaticResource ModernButton}">
            <Setter Property="Background" Value="#1F1F1F"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#2A2A2A"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>
    
    <Grid Margin="30,25,30,30">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,20">
            <TextBlock Text="Settings" 
                       FontSize="28" 
                       FontWeight="SemiBold" 
                       Foreground="#FFFFFF"/>
            <TextBlock Text="Configure your recording preferences" 
                       FontSize="13" 
                       Foreground="#707070"
                       Margin="0,2,0,0"/>
        </StackPanel>

        <!-- Settings Content -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <StackPanel>
                
                <!-- Recording Settings Section -->
                <Border Background="#161616" 
                        CornerRadius="12" 
                        Padding="20" 
                        Margin="0,0,0,15">
                    <Border.Effect>
                        <DropShadowEffect Color="#000000" 
                                        BlurRadius="15" 
                                        ShadowDepth="3" 
                                        Opacity="0.4"/>
                    </Border.Effect>
                    <StackPanel>
                        <TextBlock Text="Recording" 
                                   FontSize="16" 
                                   FontWeight="SemiBold" 
                                   Foreground="#FFFFFF"
                                   Margin="0,0,0,16"/>

                        <!-- Save Location -->
                        <TextBlock Text="Save Location" 
                                   Foreground="#B0B0B0" 
                                   FontSize="12"
                                   Margin="0,0,0,8"/>
                        <Grid Margin="0,0,0,16">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBox x:Name="SavePathText" 
                                     Grid.Column="0"
                                     Style="{StaticResource ModernTextBox}"
                                     IsReadOnly="True"/>
                            <Button Grid.Column="1"
                                    Content="Browse..."
                                    Width="90"
                                    Height="36"
                                    Margin="10,0,0,0"
                                    Style="{StaticResource SecondaryButton}"
                                    Padding="12,0"
                                    Click="BrowseSavePath_Click"/>
                        </Grid>

                        <!-- Buffer Duration -->
                        <TextBlock Text="Buffer Duration" 
                                   Foreground="#B0B0B0" 
                                   FontSize="12"
                                   Margin="0,0,0,8"/>
                        <Grid Margin="0,0,0,16">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Slider x:Name="BufferSlider" 
                                    Grid.Column="0"
                                    Minimum="10" 
                                    Maximum="120" 
                                    Value="30" 
                                    TickFrequency="10"
                                    IsSnapToTickEnabled="True"
                                    Style="{StaticResource ModernSlider}"
                                    ValueChanged="BufferSlider_ValueChanged"/>
                            <TextBlock x:Name="BufferValueText" 
                                       Grid.Column="1"
                                       Text="30s" 
                                       Foreground="#39c20f" 
                                       FontWeight="SemiBold"
                                       FontSize="14"
                                       Margin="16,0,0,0"
                                       VerticalAlignment="Center"
                                       MinWidth="50"
                                       TextAlignment="Right"/>
                        </Grid>

                        <!-- Frame Rate -->
                        <TextBlock Text="Frame Rate" 
                                   Foreground="#B0B0B0" 
                                   FontSize="12"
                                   Margin="0,0,0,8"/>
                        <ComboBox x:Name="FrameRateCombo" 
                                  Style="{StaticResource ModernComboBox}"
                                  Foreground="Black"
                                  Margin="0,0,0,16"
                                  SelectionChanged="FrameRateCombo_SelectionChanged">
                            <ComboBoxItem Content="30 FPS" Tag="30"/>
                            <ComboBoxItem Content="60 FPS" Tag="60" IsSelected="True"/>
                            <ComboBoxItem Content="120 FPS" Tag="120"/>
                        </ComboBox>

                        <!-- Memory Usage Estimate -->
                        <TextBlock x:Name="MemoryEstimateText"
                                   Text="Estimated memory: ~350 MB"
                                   FontSize="11"
                                   Foreground="#606060"
                                   FontStyle="Italic"/>
                    </StackPanel>
                </Border>

                <!-- Audio Settings Section -->
                <Border Background="#161616" 
                        CornerRadius="12" 
                        Padding="20" 
                        Margin="0,0,0,15">
                    <Border.Effect>
                        <DropShadowEffect Color="#000000" 
                                        BlurRadius="15" 
                                        ShadowDepth="3" 
                                        Opacity="0.4"/>
                    </Border.Effect>
                    <StackPanel>
                        <TextBlock Text="Audio" 
                                   FontSize="16" 
                                   FontWeight="SemiBold" 
                                   Foreground="#FFFFFF"
                                   Margin="0,0,0,16"/>

                        <!-- Enable Audio -->
                        <CheckBox x:Name="RecordAudioCheck" 
                                  Content="Enable audio recording" 
                                  Style="{StaticResource ModernCheckBox}"
                                  IsChecked="True"
                                  Margin="0,0,0,16"
                                  Checked="RecordAudioCheck_Changed"
                                  Unchecked="RecordAudioCheck_Changed"/>

                        <!-- Audio Options Panel -->
                        <StackPanel x:Name="AudioOptionsPanel">
                            <!-- Desktop Audio -->
                            <CheckBox x:Name="RecordDesktopCheck" 
                                      Content="Record desktop audio" 
                                      Style="{StaticResource ModernCheckBox}"
                                      IsChecked="True"
                                      Margin="0,0,0,12"
                                      Checked="AudioSourceCheck_Changed"
                                      Unchecked="AudioSourceCheck_Changed"/>
                            
                            <StackPanel x:Name="DesktopAudioPanel" Margin="24,0,0,16">
                                <TextBlock Text="Desktop Audio Device" 
                                           Foreground="#909090" 
                                           FontSize="11"
                                           Margin="0,0,0,6"/>
                                <ComboBox x:Name="DesktopDeviceCombo" 
                                          Style="{StaticResource ModernComboBox}"
                                          Foreground="Black"
                                          Margin="0,0,0,12"/>
                                
                                <TextBlock Text="Volume" 
                                           Foreground="#909090" 
                                           FontSize="11"
                                           Margin="0,0,0,6"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider x:Name="DesktopVolumeSlider" 
                                            Grid.Column="0"
                                            Minimum="0" 
                                            Maximum="200" 
                                            Value="100" 
                                            TickFrequency="10"
                                            IsSnapToTickEnabled="True"
                                            Style="{StaticResource ModernSlider}"
                                            ValueChanged="DesktopVolumeSlider_ValueChanged"/>
                                    <TextBlock x:Name="DesktopVolumeText" 
                                               Grid.Column="1"
                                               Text="100%" 
                                               Foreground="#39c20f" 
                                               FontWeight="SemiBold"
                                               FontSize="13"
                                               Margin="16,0,0,0"
                                               VerticalAlignment="Center"
                                               MinWidth="50"
                                               TextAlignment="Right"/>
                                </Grid>
                            </StackPanel>

                            <!-- Microphone -->
                            <CheckBox x:Name="RecordMicCheck" 
                                      Content="Record microphone" 
                                      Style="{StaticResource ModernCheckBox}"
                                      IsChecked="True"
                                      Margin="0,0,0,12"
                                      Checked="AudioSourceCheck_Changed"
                                      Unchecked="AudioSourceCheck_Changed"/>
                            
                            <StackPanel x:Name="MicrophonePanel" Margin="24,0,0,0">
                                <TextBlock Text="Microphone Device" 
                                           Foreground="#909090" 
                                           FontSize="11"
                                           Margin="0,0,0,6"/>
                                <ComboBox x:Name="MicDeviceCombo" 
                                          Style="{StaticResource ModernComboBox}"
                                          Foreground="Black"
                                          Margin="0,0,0,12"/>
                                
                                <TextBlock Text="Volume" 
                                           Foreground="#909090" 
                                           FontSize="11"
                                           Margin="0,0,0,6"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider x:Name="MicVolumeSlider" 
                                            Grid.Column="0"
                                            Minimum="0" 
                                            Maximum="200" 
                                            Value="100" 
                                            TickFrequency="10"
                                            IsSnapToTickEnabled="True"
                                            Style="{StaticResource ModernSlider}"
                                            ValueChanged="MicVolumeSlider_ValueChanged"/>
                                    <TextBlock x:Name="MicVolumeText" 
                                               Grid.Column="1"
                                               Text="100%" 
                                               Foreground="#39c20f" 
                                               FontWeight="SemiBold"
                                               FontSize="13"
                                               Margin="16,0,0,0"
                                               VerticalAlignment="Center"
                                               MinWidth="50"
                                               TextAlignment="Right"/>
                                </Grid>
                            </StackPanel>
                        </StackPanel>

                        <TextBlock Text="ðŸ’¡ Desktop and microphone audio will be mixed together"
                                   FontSize="11"
                                   Foreground="#606060"
                                   Margin="0,12,0,0"
                                   TextWrapping="Wrap"/>
                    </StackPanel>
                </Border>

                <!-- Video Quality Section -->
                <Border Background="#161616" 
                        CornerRadius="12" 
                        Padding="20" 
                        Margin="0,0,0,15">
                    <Border.Effect>
                        <DropShadowEffect Color="#000000" 
                                        BlurRadius="15" 
                                        ShadowDepth="3" 
                                        Opacity="0.4"/>
                    </Border.Effect>
                    <StackPanel>
                        <TextBlock Text="Video Quality" 
                                   FontSize="16" 
                                   FontWeight="SemiBold" 
                                   Foreground="#FFFFFF"
                                   Margin="0,0,0,16"/>

                        <!-- Quality Preset -->
                        <TextBlock Text="Quality Preset" 
                                   Foreground="#B0B0B0" 
                                   FontSize="12"
                                   Margin="0,0,0,8"/>
                        <ComboBox x:Name="QualityCombo" 
                                  Style="{StaticResource ModernComboBox}"
                                  Foreground="Black"
                                  Margin="0,0,0,12"
                                  SelectionChanged="QualityCombo_SelectionChanged">
                            <ComboBoxItem Content="Low (2 Mbps, smaller files)" Tag="Low"/>
                            <ComboBoxItem Content="Medium (5 Mbps, balanced)" Tag="Medium"/>
                            <ComboBoxItem Content="High (8 Mbps, recommended)" Tag="High" IsSelected="True"/>
                            <ComboBoxItem Content="Very High (12 Mbps, great quality)" Tag="VeryHigh"/>
                            <ComboBoxItem Content="Ultra (20 Mbps, maximum quality)" Tag="Ultra"/>
                            <ComboBoxItem Content="Custom (advanced)" Tag="Custom"/>
                        </ComboBox>

                        <!-- Custom Settings Panel -->
                        <StackPanel x:Name="CustomPanel" Visibility="Collapsed">
                            <TextBlock Text="Bitrate (bps)" 
                                       Foreground="#B0B0B0" 
                                       FontSize="12"
                                       Margin="0,8,0,8"/>
                            <TextBox x:Name="BitrateText" 
                                     Style="{StaticResource ModernTextBox}"
                                     Text="8000000"
                                     Margin="0,0,0,12"/>

                            <TextBlock Text="CRF (18-28, lower = better quality)" 
                                       Foreground="#B0B0B0" 
                                       FontSize="12"
                                       Margin="0,0,0,8"/>
                            <TextBox x:Name="CRFText" 
                                     Style="{StaticResource ModernTextBox}"
                                     Text="23"
                                     Margin="0,0,0,12"/>
                        </StackPanel>

                        <!-- Hardware Encoding -->
                        <CheckBox x:Name="HardwareEncodingCheck" 
                                  Content="Use hardware encoding (NVENC/QuickSync)" 
                                  Style="{StaticResource ModernCheckBox}"
                                  IsChecked="True"
                                  Margin="0,8,0,6"/>
                        <TextBlock Text="Requires NVIDIA or Intel GPU with encoder support"
                                   FontSize="11"
                                   Foreground="#606060"
                                   Margin="24,0,0,0"/>
                    </StackPanel>
                </Border>

                <!-- Info Section -->
                <Border Background="#161616" 
                        CornerRadius="12" 
                        Padding="20">
                    <Border.Effect>
                        <DropShadowEffect Color="#000000" 
                                        BlurRadius="15" 
                                        ShadowDepth="3" 
                                        Opacity="0.4"/>
                    </Border.Effect>
                    <StackPanel>
                        <TextBlock Text="ðŸ’¡ Tips" 
                                   FontSize="14" 
                                   FontWeight="SemiBold" 
                                   Foreground="#FFFFFF"
                                   Margin="0,0,0,12"/>
                        <TextBlock TextWrapping="Wrap" 
                                   Foreground="#909090" 
                                   FontSize="12"
                                   LineHeight="20">
                            <Run Text="â€¢ Higher buffer = more memory usage"/>
                            <LineBreak/>
                            <Run Text="â€¢ 60 FPS recommended for smooth playback"/>
                            <LineBreak/>
                            <Run Text="â€¢ Hardware encoding reduces CPU usage"/>
                            <LineBreak/>
                            <Run Text="â€¢ Lower quality = smaller file sizes"/>
                            <LineBreak/>
                            <Run Text="â€¢ Audio is recorded at 48kHz stereo AAC"/>
                            <LineBreak/>
                            <Run Text="â€¢ Changes require restart of recording"/>
                        </TextBlock>
                    </StackPanel>
                </Border>

            </StackPanel>
        </ScrollViewer>

        <!-- Action Buttons -->
        <Grid Grid.Row="2" Margin="0,20,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <Button Grid.Column="0"
                    Content="Cancel"
                    Height="44"
                    FontSize="14"
                    Padding="18,0"
                    Style="{StaticResource SecondaryButton}"
                    Click="Cancel_Click"
                    Margin="0,0,10,0"/>

            <Button Grid.Column="1"
                    Content="Save &amp; Apply"
                    Width="140"
                    Height="44"
                    FontSize="14"
                    Padding="18,0"
                    Style="{StaticResource GreenButton}"
                    Click="Save_Click"/>
        </Grid>
    </Grid>
</Window>
