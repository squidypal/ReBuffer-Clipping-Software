<Window x:Class="ReBuffer.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="ReBuffer Settings" 
        Height="750" 
        Width="550"
        WindowStartupLocation="CenterScreen"
        ResizeMode="NoResize"
        Background="#1E1E1E">
    
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <TextBlock Grid.Row="0" 
                   Text="Settings" 
                   FontSize="24" 
                   FontWeight="Bold" 
                   Foreground="#00D9FF"
                   Margin="0,0,0,20"/>

        <!-- Settings Content -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <StackPanel>
                
                <!-- Recording Settings Section -->
                <Border Background="#2D2D2D" CornerRadius="8" Padding="15" Margin="0,0,0,15">
                    <StackPanel>
                        <TextBlock Text="Recording Settings" 
                                   FontSize="16" 
                                   FontWeight="SemiBold" 
                                   Foreground="#00D9FF"
                                   Margin="0,0,0,15"/>

                        <!-- Save Location -->
                        <TextBlock Text="Save Location:" 
                                   Foreground="#CCC" 
                                   Margin="0,0,0,5"/>
                        <Grid Margin="0,0,0,15">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBox x:Name="SavePathText" 
                                     Grid.Column="0"
                                     Background="#1E1E1E" 
                                     Foreground="#CCC"
                                     BorderBrush="#444"
                                     Padding="5"
                                     IsReadOnly="True"
                                     VerticalContentAlignment="Center"/>
                            <Button Grid.Column="1"
                                    Content="Browse..."
                                    Width="80"
                                    Height="30"
                                    Margin="5,0,0,0"
                                    Background="#444"
                                    Foreground="White"
                                    BorderThickness="0"
                                    Cursor="Hand"
                                    Click="BrowseSavePath_Click">
                                <Button.Style>
                                    <Style TargetType="Button">
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="Button">
                                                    <Border Background="{TemplateBinding Background}"
                                                            CornerRadius="4"
                                                            Padding="8,4">
                                                        <ContentPresenter HorizontalAlignment="Center" 
                                                                        VerticalAlignment="Center"/>
                                                    </Border>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Background" Value="#555"/>
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </Button.Style>
                            </Button>
                        </Grid>

                        <!-- Buffer Duration -->
                        <TextBlock Text="Buffer Duration (seconds):" 
                                   Foreground="#CCC" 
                                   Margin="0,0,0,5"/>
                        <Grid Margin="0,0,0,15">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Slider x:Name="BufferSlider" 
                                    Grid.Column="0"
                                    Minimum="10" 
                                    Maximum="120" 
                                    Value="30" 
                                    TickFrequency="10"
                                    IsSnapToTickEnabled="True"
                                    ValueChanged="BufferSlider_ValueChanged"/>
                            <TextBlock x:Name="BufferValueText" 
                                       Grid.Column="1"
                                       Text="30s" 
                                       Foreground="#00D9FF" 
                                       FontWeight="Bold"
                                       Margin="10,0,0,0"
                                       VerticalAlignment="Center"
                                       Width="50"
                                       TextAlignment="Right"/>
                        </Grid>

                        <!-- Frame Rate -->
                        <TextBlock Text="Frame Rate:" 
                                   Foreground="#CCC" 
                                   Margin="0,0,0,5"/>
                        <ComboBox x:Name="FrameRateCombo" 
                                  Background="#1E1E1E" 
                                  Foreground="#CCC"
                                  BorderBrush="#444"
                                  Margin="0,0,0,15"
                                  SelectionChanged="FrameRateCombo_SelectionChanged">
                            <ComboBoxItem Content="30 FPS" Tag="30"/>
                            <ComboBoxItem Content="60 FPS" Tag="60" IsSelected="True"/>
                            <ComboBoxItem Content="120 FPS" Tag="120"/>
                        </ComboBox>

                        <!-- Memory Usage Estimate -->
                        <TextBlock x:Name="MemoryEstimateText"
                                   Text="Estimated memory: ~350 MB"
                                   FontSize="11"
                                   Foreground="#888"
                                   FontStyle="Italic"/>
                    </StackPanel>
                </Border>

                <!-- Audio Settings Section -->
                <Border Background="#2D2D2D" CornerRadius="8" Padding="15" Margin="0,0,0,15">
                    <StackPanel>
                        <TextBlock Text="Audio Settings" 
                                   FontSize="16" 
                                   FontWeight="SemiBold" 
                                   Foreground="#00D9FF"
                                   Margin="0,0,0,15"/>

                        <!-- Enable Audio -->
                        <CheckBox x:Name="RecordAudioCheck" 
                                  Content="Enable audio recording" 
                                  Foreground="#CCC"
                                  IsChecked="True"
                                  Margin="0,0,0,15"
                                  Checked="RecordAudioCheck_Changed"
                                  Unchecked="RecordAudioCheck_Changed"/>

                        <!-- Audio Options Panel -->
                        <StackPanel x:Name="AudioOptionsPanel">
                            <!-- Desktop Audio -->
                            <CheckBox x:Name="RecordDesktopCheck" 
                                      Content="Record desktop audio (system sounds)" 
                                      Foreground="#CCC"
                                      IsChecked="True"
                                      Margin="0,0,0,10"
                                      Checked="AudioSourceCheck_Changed"
                                      Unchecked="AudioSourceCheck_Changed"/>
                            
                            <StackPanel x:Name="DesktopAudioPanel" Margin="20,0,0,15">
                                <TextBlock Text="Desktop Audio Device:" 
                                           Foreground="#AAA" 
                                           FontSize="11"
                                           Margin="0,0,0,5"/>
                                <ComboBox x:Name="DesktopDeviceCombo" 
                                          Background="#1E1E1E" 
                                          Foreground="#CCC"
                                          BorderBrush="#444"
                                          Margin="0,0,0,10"/>
                                
                                <TextBlock Text="Desktop Volume:" 
                                           Foreground="#AAA" 
                                           FontSize="11"
                                           Margin="0,0,0,5"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider x:Name="DesktopVolumeSlider" 
                                            Grid.Column="0"
                                            Minimum="0" 
                                            Maximum="200" 
                                            Value="100" 
                                            TickFrequency="10"
                                            IsSnapToTickEnabled="True"
                                            ValueChanged="DesktopVolumeSlider_ValueChanged"/>
                                    <TextBlock x:Name="DesktopVolumeText" 
                                               Grid.Column="1"
                                               Text="100%" 
                                               Foreground="#00D9FF" 
                                               FontWeight="Bold"
                                               Margin="10,0,0,0"
                                               VerticalAlignment="Center"
                                               Width="50"
                                               TextAlignment="Right"/>
                                </Grid>
                            </StackPanel>

                            <!-- Microphone -->
                            <CheckBox x:Name="RecordMicCheck" 
                                      Content="Record microphone" 
                                      Foreground="#CCC"
                                      IsChecked="True"
                                      Margin="0,0,0,10"
                                      Checked="AudioSourceCheck_Changed"
                                      Unchecked="AudioSourceCheck_Changed"/>
                            
                            <StackPanel x:Name="MicrophonePanel" Margin="20,0,0,0">
                                <TextBlock Text="Microphone Device:" 
                                           Foreground="#AAA" 
                                           FontSize="11"
                                           Margin="0,0,0,5"/>
                                <ComboBox x:Name="MicDeviceCombo" 
                                          Background="#1E1E1E" 
                                          Foreground="#CCC"
                                          BorderBrush="#444"
                                          Margin="0,0,0,10"/>
                                
                                <TextBlock Text="Microphone Volume:" 
                                           Foreground="#AAA" 
                                           FontSize="11"
                                           Margin="0,0,0,5"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider x:Name="MicVolumeSlider" 
                                            Grid.Column="0"
                                            Minimum="0" 
                                            Maximum="200" 
                                            Value="100" 
                                            TickFrequency="10"
                                            IsSnapToTickEnabled="True"
                                            ValueChanged="MicVolumeSlider_ValueChanged"/>
                                    <TextBlock x:Name="MicVolumeText" 
                                               Grid.Column="1"
                                               Text="100%" 
                                               Foreground="#00D9FF" 
                                               FontWeight="Bold"
                                               Margin="10,0,0,0"
                                               VerticalAlignment="Center"
                                               Width="50"
                                               TextAlignment="Right"/>
                                </Grid>
                            </StackPanel>
                        </StackPanel>

                        <TextBlock Text="ðŸ’¡ Both desktop and microphone audio will be mixed together"
                                   FontSize="10"
                                   Foreground="#888"
                                   Margin="0,10,0,0"
                                   TextWrapping="Wrap"/>
                    </StackPanel>
                </Border>

                <!-- Video Quality Section -->
                <Border Background="#2D2D2D" CornerRadius="8" Padding="15" Margin="0,0,0,15">
                    <StackPanel>
                        <TextBlock Text="Video Quality" 
                                   FontSize="16" 
                                   FontWeight="SemiBold" 
                                   Foreground="#00D9FF"
                                   Margin="0,0,0,15"/>

                        <!-- Quality Preset -->
                        <TextBlock Text="Quality Preset:" 
                                   Foreground="#CCC" 
                                   Margin="0,0,0,5"/>
                        <ComboBox x:Name="QualityCombo" 
                                  Background="#1E1E1E" 
                                  Foreground="#CCC"
                                  BorderBrush="#444"
                                  Margin="0,0,0,10"
                                  SelectionChanged="QualityCombo_SelectionChanged">
                            <ComboBoxItem Content="Low (2 Mbps, smaller files)" Tag="Low"/>
                            <ComboBoxItem Content="Medium (5 Mbps, balanced)" Tag="Medium"/>
                            <ComboBoxItem Content="High (8 Mbps, recommended)" Tag="High" IsSelected="True"/>
                            <ComboBoxItem Content="Very High (12 Mbps, great quality)" Tag="VeryHigh"/>
                            <ComboBoxItem Content="Ultra (20 Mbps, maximum quality)" Tag="Ultra"/>
                            <ComboBoxItem Content="Custom (advanced)" Tag="Custom"/>
                        </ComboBox>

                        <!-- Custom Settings Panel -->
                        <StackPanel x:Name="CustomPanel" Visibility="Collapsed">
                            <TextBlock Text="Bitrate (bps):" 
                                       Foreground="#CCC" 
                                       Margin="0,10,0,5"/>
                            <TextBox x:Name="BitrateText" 
                                     Background="#1E1E1E" 
                                     Foreground="#CCC"
                                     BorderBrush="#444"
                                     Padding="5"
                                     Text="8000000"
                                     Margin="0,0,0,10"/>

                            <TextBlock Text="CRF (18-28, lower = better quality):" 
                                       Foreground="#CCC" 
                                       Margin="0,0,0,5"/>
                            <TextBox x:Name="CRFText" 
                                     Background="#1E1E1E" 
                                     Foreground="#CCC"
                                     BorderBrush="#444"
                                     Padding="5"
                                     Text="23"
                                     Margin="0,0,0,10"/>
                        </StackPanel>

                        <!-- Hardware Encoding -->
                        <CheckBox x:Name="HardwareEncodingCheck" 
                                  Content="Use hardware encoding (NVENC/QuickSync)" 
                                  Foreground="#CCC"
                                  IsChecked="True"
                                  Margin="0,10,0,5"/>
                        <TextBlock Text="Requires NVIDIA or Intel GPU with encoder support"
                                   FontSize="10"
                                   Foreground="#888"
                                   Margin="20,0,0,0"/>
                    </StackPanel>
                </Border>

                <!-- Info Section -->
                <Border Background="#2D2D2D" CornerRadius="8" Padding="15">
                    <StackPanel>
                        <TextBlock Text="â„¹ï¸ Tips" 
                                   FontSize="14" 
                                   FontWeight="SemiBold" 
                                   Foreground="#00D9FF"
                                   Margin="0,0,0,10"/>
                        <TextBlock TextWrapping="Wrap" 
                                   Foreground="#AAA" 
                                   FontSize="11"
                                   LineHeight="18">
                            <Run Text="â€¢ Higher buffer = more memory usage"/>
                            <LineBreak/>
                            <Run Text="â€¢ 60 FPS recommended for smooth playback"/>
                            <LineBreak/>
                            <Run Text="â€¢ Hardware encoding reduces CPU usage"/>
                            <LineBreak/>
                            <Run Text="â€¢ Lower quality = smaller file sizes"/>
                            <LineBreak/>
                            <Run Text="â€¢ Audio is recorded at 48kHz stereo AAC"/>
                            <LineBreak/>
                            <Run Text="â€¢ Changes require restart of recording"/>
                        </TextBlock>
                    </StackPanel>
                </Border>

            </StackPanel>
        </ScrollViewer>

        <!-- Action Buttons -->
        <StackPanel Grid.Row="2" 
                    Orientation="Horizontal" 
                    HorizontalAlignment="Right"
                    Margin="0,20,0,0">
            <Button Content="Cancel"
                    Width="100"
                    Height="35"
                    FontSize="13"
                    Background="#444"
                    Foreground="White"
                    BorderThickness="0"
                    Cursor="Hand"
                    Click="Cancel_Click"
                    Margin="0,0,10,0">
                <Button.Style>
                    <Style TargetType="Button">
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}"
                                            CornerRadius="6"
                                            Padding="10,8">
                                        <ContentPresenter HorizontalAlignment="Center" 
                                                        VerticalAlignment="Center"/>
                                    </Border>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#555"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>

            <Button Content="Save &amp; Apply"
                    Width="120"
                    Height="35"
                    FontSize="13"
                    Background="#4CAF50"
                    Foreground="White"
                    BorderThickness="0"
                    Cursor="Hand"
                    Click="Save_Click">
                <Button.Style>
                    <Style TargetType="Button">
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}"
                                            CornerRadius="6"
                                            Padding="10,8">
                                        <ContentPresenter HorizontalAlignment="Center" 
                                                        VerticalAlignment="Center"/>
                                    </Border>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#66BB6A"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>
        </StackPanel>
    </Grid>
</Window>
